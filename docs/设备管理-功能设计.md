### **<font style="color:rgb(27, 28, 29);">AIgoOne 功能设计文档 V1.3</font>**
**<font style="color:rgb(27, 28, 29);">模块：设备管理 (Device Management)</font>**

| **<font style="color:rgb(27, 28, 29);">版本</font>** | **<font style="color:rgb(27, 28, 29);">修订日期</font>** | **<font style="color:rgb(27, 28, 29);">修订人</font>** | **<font style="color:rgb(27, 28, 29);">修订说明</font>** |
| --- | --- | --- | --- |
| <font style="color:rgb(27, 28, 29);">1.3</font> | <font style="color:rgb(27, 28, 29);">2025-08-08</font> | <font style="color:rgb(27, 28, 29);">总设计师</font> | <font style="color:rgb(27, 28, 29);">终稿。根据最终确认的凭证处理、状态同步及批量操作需求完成。</font> |


#### <font style="color:rgb(27, 28, 29);">1. 功能概述 (Objective)</font>
<font style="color:rgb(27, 28, 29);">设备管理是 AIgoOne 平台的基石。它负责注册、认证和维护所有边缘算力节点（即“算法应用平台”）的连接信息。此模块的稳定性和安全性，是保障上层所有数据聚合与业务管理功能正常运行的前提。本设计旨在提供一个安全、清晰、易于操作的设备统一纳管界面。</font>

#### <font style="color:rgb(27, 28, 29);">2. 功能需求 (Functional Requirements)</font>
**<font style="color:rgb(27, 28, 29);">2.1. 设备列表视图</font>**

+ **<font style="color:rgb(27, 28, 29);">FR1.1 - 布局与列定义:</font>**<font style="color:rgb(27, 28, 29);"> 系统应以表格（Table）形式展示所有已添加的设备。表格包含以下列：</font>
    - **<font style="color:rgb(27, 28, 29);">设备信息:</font>**<font style="color:rgb(27, 28, 29);"> 主字段为用户设定的“设备别名”，次要字段为设备的访问地址 (URL)。</font>
    - **<font style="color:rgb(27, 28, 29);">设备类型:</font>**<font style="color:rgb(27, 28, 29);"> 来自 API </font>`<font style="color:rgb(87, 91, 95);">GET /v1/device/info</font>`<font style="color:rgb(27, 28, 29);"> 返回的 </font>`<font style="color:rgb(87, 91, 95);">type</font>`<font style="color:rgb(27, 28, 29);"> 字段。</font>
    - **<font style="color:rgb(27, 28, 29);">软件版本:</font>**<font style="color:rgb(27, 28, 29);"> 来自 API </font>`<font style="color:rgb(87, 91, 95);">GET /v1/device/info</font>`<font style="color:rgb(27, 28, 29);"> 返回的 </font>`<font style="color:rgb(87, 91, 95);">version</font>`<font style="color:rgb(27, 28, 29);"> 字段。</font>
    - **<font style="color:rgb(27, 28, 29);">状态:</font>**<font style="color:rgb(27, 28, 29);"> 显示设备的实时连接状态，包含三种可能值：</font>
        * **<font style="color:rgb(27, 28, 29);">在线:</font>**<font style="color:rgb(27, 28, 29);"> 绿色标识。表示连接正常，API可访问。</font>
        * **<font style="color:rgb(27, 28, 29);">离线:</font>**<font style="color:rgb(27, 28, 29);"> 灰色标识。表示网络不可达或服务未响应。</font>
        * **<font style="color:rgb(27, 28, 29);">验证失败:</font>**<font style="color:rgb(27, 28, 29);"> 红色标识。表示网络可达，但使用已存凭证登录失败（HTTP 401），通常意味着密码已在源端被修改。</font>
    - **<font style="color:rgb(27, 28, 29);">最后同步时间:</font>**<font style="color:rgb(27, 28, 29);"> 系统记录的最近一次手动同步（单点或批量）成功的时间戳。</font>
    - **<font style="color:rgb(27, 28, 29);">操作:</font>**<font style="color:rgb(27, 28, 29);"> 每一行都包含一组操作按钮：“同步”、“编辑”、“详情”、“删除”。</font>

**<font style="color:rgb(27, 28, 29);">2.2. 设备添加与导入</font>**

+ **<font style="color:rgb(27, 28, 29);">FR2.1 - 单个添加:</font>**
    - <font style="color:rgb(27, 28, 29);">列表上方提供“添加设备”按钮，点击后弹出表单。</font>
    - <font style="color:rgb(27, 28, 29);">表单字段包括：设备别名（用户在AIgoOne中自定义）、URL、用户名、密码。</font>
    - <font style="color:rgb(27, 28, 29);">提交时，系统会立即尝试连接并验证，成功后才添加至列表。</font>
+ **<font style="color:rgb(27, 28, 29);">FR2.2 - 批量导入:</font>**
    - <font style="color:rgb(27, 28, 29);">列表上方提供“导入设备”按钮。</font>
    - <font style="color:rgb(27, 28, 29);">支持通过上传特定格式的 CSV 文件来批量添加设备。</font>
    - <font style="color:rgb(27, 28, 29);">CSV 文件需包含列：</font>`<font style="color:rgb(87, 91, 95);">alias</font>`<font style="color:rgb(27, 28, 29);"> (设备别名), </font>`<font style="color:rgb(87, 91, 95);">url</font>`<font style="color:rgb(27, 28, 29);">, </font>`<font style="color:rgb(87, 91, 95);">username</font>`<font style="color:rgb(27, 28, 29);">, </font>`<font style="color:rgb(87, 91, 95);">password</font>`<font style="color:rgb(27, 28, 29);">。</font>

**<font style="color:rgb(27, 28, 29);">2.3. 设备管理操作</font>**

+ **<font style="color:rgb(27, 28, 29);">FR3.1 - 编辑:</font>**<font style="color:rgb(27, 28, 29);"> 允许用户修改已添加设备的“设备别名”、“URL”、“用户名”和“密码”。</font>
+ **<font style="color:rgb(27, 28, 29);">FR3.2 - 删除 (单点与批量):</font>**
    - <font style="color:rgb(27, 28, 29);">用户可勾选列表中的一个或多个设备，进行批量删除。</font>
    - <font style="color:rgb(27, 28, 29);">删除前必须有二次弹窗，并明确警告：“</font>**<font style="color:rgb(27, 28, 29);">删除设备将永久解除其所有视频源的业务绑定关系，此操作不可恢复，是否确认？</font>**<font style="color:rgb(27, 28, 29);">”</font>
+ **<font style="color:rgb(27, 28, 29);">FR3.3 - 同步 (单点与批量):</font>**
    - <font style="color:rgb(27, 28, 29);">用户可对单个或批量勾选的设备执行“同步”操作。</font>
    - <font style="color:rgb(27, 28, 29);">同步操作会触发系统重新验证凭证、获取最新的设备信息和状态，并更新列表。</font>
+ **<font style="color:rgb(27, 28, 29);">FR3.4 - 查看详情:</font>**
    - <font style="color:rgb(27, 28, 29);">点击“详情”，进入设备详情页。</font>
    - <font style="color:rgb(27, 28, 29);">详情页上方展示设备的基础信息（同列表页）。</font>
    - <font style="color:rgb(27, 28, 29);">下方以列表形式展示该设备关联的所有</font>**<font style="color:rgb(27, 28, 29);">算法应用</font>**<font style="color:rgb(27, 28, 29);">，列表需支持按算法名称搜索。</font>
    - <font style="color:rgb(27, 28, 29);">算法列表的列应包括：算法名称 (</font>`<font style="color:rgb(87, 91, 95);">name</font>`<font style="color:rgb(27, 28, 29);">)、类型 (</font>`<font style="color:rgb(87, 91, 95);">type</font>`<font style="color:rgb(27, 28, 29);">)、授权路数 (</font>`<font style="color:rgb(87, 91, 95);">limit</font>`<font style="color:rgb(27, 28, 29);">)、已用路数 (</font>`<font style="color:rgb(87, 91, 95);">used</font>`<font style="color:rgb(27, 28, 29);">)、</font>**<font style="color:rgb(27, 28, 29);">授权到期时间 (</font>**`**<font style="color:rgb(87, 91, 95);">expired_at</font>**`**<font style="color:rgb(27, 28, 29);">)</font>**<font style="color:rgb(27, 28, 29);">。</font>

**<font style="color:rgb(27, 28, 29);">2.4. 凭证与状态的自动处理</font>**

+ **<font style="color:rgb(27, 28, 29);">FR4.1 - 凭证加密:</font>**<font style="color:rgb(27, 28, 29);"> AIgoOne 后端在数据库中存储用户提供的设备密码时，</font>**<font style="color:rgb(27, 28, 29);">必须</font>**<font style="color:rgb(27, 28, 29);">使用高强度的加密措施（如 AES-256 双向加密），严禁明文存储。</font>
+ **<font style="color:rgb(27, 28, 29);">FR4.2 - Token 自动续期:</font>**<font style="color:rgb(27, 28, 29);"> 当 AIgoOne 调用设备 API 时，如果遇到 </font>`<font style="color:rgb(87, 91, 95);">token</font>`<font style="color:rgb(27, 28, 29);"> 失效（如收到 HTTP 401 错误），系统应</font>**<font style="color:rgb(27, 28, 29);">自动、静默地</font>**<font style="color:rgb(27, 28, 29);">尝试使用保存的用户名和密码调用 </font>`<font style="color:rgb(87, 91, 95);">POST /v1/login</font>`<font style="color:rgb(27, 28, 29);"> 接口获取新 </font>`<font style="color:rgb(87, 91, 95);">token</font>`<font style="color:rgb(27, 28, 29);"> 并更新。</font>
+ **<font style="color:rgb(27, 28, 29);">FR4.3 - 状态更新逻辑:</font>**
    - <font style="color:rgb(27, 28, 29);">在执行“同步”或“自动续期 </font>`<font style="color:rgb(87, 91, 95);">token</font>`<font style="color:rgb(27, 28, 29);">”操作时：</font>
        * <font style="color:rgb(27, 28, 29);">如果网络不通/超时，则设备状态更新为“</font>**<font style="color:rgb(27, 28, 29);">离线</font>**<font style="color:rgb(27, 28, 29);">”。</font>
        * <font style="color:rgb(27, 28, 29);">如果登录接口返回401等凭证错误，则设备状态更新为“</font>**<font style="color:rgb(27, 28, 29);">验证失败</font>**<font style="color:rgb(27, 28, 29);">”。</font>
        * <font style="color:rgb(27, 28, 29);">如果所有接口调用成功，则设备状态更新为“</font>**<font style="color:rgb(27, 28, 29);">在线</font>**<font style="color:rgb(27, 28, 29);">”，并刷新其他元数据。</font>

---

#### <font style="color:rgb(27, 28, 29);">3. 与算法应用平台的API交互说明</font>
<font style="color:rgb(27, 28, 29);">这是为开发团队提供的核心参考，明确了本模块各项功能与下层API的对应关系。</font>

| **<font style="color:rgb(27, 28, 29);">AIgoOne 用户操作</font>** | **<font style="color:rgb(27, 28, 29);">触发的后端逻辑</font>** | **<font style="color:rgb(27, 28, 29);">调用的“算法应用平台”API</font>** | **<font style="color:rgb(27, 28, 29);">目的</font>** |
| --- | --- | --- | --- |
| **<font style="color:rgb(27, 28, 29);">添加设备</font>** | <font style="color:rgb(27, 28, 29);">验证并存储设备信息</font> | <font style="color:rgb(27, 28, 29);">1. </font>`<font style="color:rgb(87, 91, 95);">POST /v1/login</font>`<br/><font style="color:rgb(27, 28, 29);"> <br> 2. </font>`<font style="color:rgb(87, 91, 95);">GET /v1/device/info</font>` | <font style="color:rgb(27, 28, 29);">获取初始Token，验证凭证，获取设备元数据</font> |
| **<font style="color:rgb(27, 28, 29);">同步设备 (单/批量)</font>** | <font style="color:rgb(27, 28, 29);">刷新设备状态和信息</font> | <font style="color:rgb(27, 28, 29);">1. </font>`<font style="color:rgb(87, 91, 95);">POST /v1/login</font>`<br/><font style="color:rgb(27, 28, 29);"> (仅当Token失效或主动测试) <br> 2. </font>`<font style="color:rgb(87, 91, 95);">GET /v1/device/info</font>` | <font style="color:rgb(27, 28, 29);">验证连接，获取最新Token，更新设备元数据</font> |
| **<font style="color:rgb(27, 28, 29);">查看设备详情</font>** | <font style="color:rgb(27, 28, 29);">加载设备关联的算法列表</font> | `<font style="color:rgb(87, 91, 95);">GET /v1/apps</font>`<br/><font style="color:rgb(27, 28, 29);"> (支持分页和按</font>`<font style="color:rgb(87, 91, 95);">name</font>`<br/><font style="color:rgb(27, 28, 29);">查询)</font> | <font style="color:rgb(27, 28, 29);">展示该设备上的所有算法应用及其状态</font> |
| **<font style="color:rgb(27, 28, 29);">编辑/删除/导入设备</font>** | <font style="color:rgb(27, 28, 29);">AIgoOne内部数据操作</font> | <font style="color:rgb(27, 28, 29);">(无)</font> | <font style="color:rgb(27, 28, 29);">这些操作仅涉及AIgoOne自身的数据库，不与下层平台交互</font> |
| **<font style="color:rgb(27, 28, 29);">任何对设备的操作(如拉取视频源)</font>** | <font style="color:rgb(27, 28, 29);">API调用前的Token检查</font> | `<font style="color:rgb(87, 91, 95);">POST /v1/login</font>`<br/><font style="color:rgb(27, 28, 29);"> (仅当Token失效时自动触发)</font> | <font style="color:rgb(27, 28, 29);">静默地自动续期Token，对用户无感</font> |




